!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t||self).xtermLocalEcho={})}(this,function(t){function r(t){var r=(void 0===t?{}:t).onlyFirst,i=void 0!==r&&r,e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,i?void 0:"g")}for(var i=function(){function t(t){this.size=void 0,this.entries=[],this.cursor=0,this.size=t}var r=t.prototype;return r.push=function(t){""!==t.trim()&&(t!==this.entries[this.entries.length-1]?(this.entries.push(t),this.entries.length>this.size&&this.entries.shift(),this.cursor=this.entries.length):this.cursor=this.entries.length)},r.rewind=function(){this.cursor=this.entries.length},r.getPrevious=function(){var t=Math.max(0,this.cursor-1);return this.cursor=t,this.entries[t]},r.getNext=function(){var t=Math.min(this.entries.length,this.cursor+1);return this.cursor=t,this.entries[t]},t}(),e="(?:"+["\\|\\|","\\&\\&",";;","\\|\\&","\\<\\(",">>",">\\&","[&;()|<>]"].join("|")+")",s="",n=0;n<4;n++)s+=(Math.pow(16,8)*Math.random()).toString(16);var o=function(t,r,i){var n=function(t,r,i){var n=new RegExp(["("+e+")","((\\\\['\"|&;()<> \\t]|[^\\s'\"|&;()<> \\t])+|\"((\\\\\"|[^\"])*?)\"|'((\\\\'|[^'])*?)')*"].join("|"),"g"),o=t.match(n).filter(Boolean),h=!1;return o?(r||(r={}),i||(i={}),o.map(function(t,n){if(!h){if(RegExp("^"+e+"$").test(t))return{op:t};for(var a=i.escape||"\\",u=!1,l=!1,c="",p=!1,f=0,m=t.length;f<m;f++){var v=t.charAt(f);if(p=p||!u&&("*"===v||"?"===v),l)c+=v,l=!1;else if(u)v===u?u=!1:c+="'"==u?v:v===a?'"'===(v=t.charAt(f+=1))||v===a||"$"===v?v:a+v:"$"===v?d():v;else if('"'===v||"'"===v)u=v;else{if(RegExp("^"+e+"$").test(v))return{op:t};if(RegExp("^#$").test(v))return h=!0,c.length?[c,{comment:t.slice(f+1)+o.slice(n+1).join(" ")}]:[{comment:t.slice(f+1)+o.slice(n+1).join(" ")}];v===a?l=!0:c+="$"===v?d():v}}return p?{op:"glob",pattern:c}:c}function d(){var i,e,n,o;if("{"===t.charAt(f+=1)){if("}"===t.charAt(f+=1))throw new Error("Bad substitution: "+t.substr(f-2,3));if((i=t.indexOf("}",f))<0)throw new Error("Bad substitution: "+t.substr(f));e=t.substr(f,i-f),f=i}else/[*@#?$!_\-]/.test(t.charAt(f))?(e=t.charAt(f),f+=1):(i=t.substr(f).match(/[^\w\d_]/))?(e=t.substr(f,i.index),f+=i.index-1):(e=t.substr(f),f=t.length);return n=e,void 0===(o="function"==typeof r?r(n):r[n])&&""!=n?o="":void 0===o&&(o="$"),"object"==typeof o?""+s+JSON.stringify(o)+s:""+o}}).reduce(function(t,r){return void 0===r?t:t.concat(r)},[])):[]}(t,r,i);return"function"!=typeof r?n:n.reduce(function(t,r){if("object"==typeof r)return t.concat(r);var i=r.split(RegExp("("+s+".*?"+s+")","g"));return t.concat(1===i.length?i[0]:i.filter(Boolean).map(function(t){return RegExp("^"+s).test(t)?JSON.parse(t.split(s)[1]):t}))},[])};function h(t,r){var i;void 0===r&&(r=!0);for(var e=[],s=/\w+/g;i=s.exec(t);)e.push(r?i.index:i.index+i[0].length);return e}function a(t,r){var i=h(t,!0).reverse().find(function(t){return t<r});return null==i?0:i}function u(t,r,i){for(var e=0,s=0,n=0;n<r;++n)("\n"===t.charAt(n)||(s+=1)>i)&&(s=0,e+=1);return{row:e,col:s}}function l(t,i){return u(t,t.replace(r(),"").length,i).row+1}function c(t){return null!=t.match(/[^\\][ \t]$/m)}function p(t){return""===t.trim()||c(t)?"":o(t).pop()||""}function f(t,r){if(t.length>=r[0].length)return t;var i=t;t+=r[0].slice(t.length,t.length+1);for(var e=0;e<r.length;e++){if(!r[e].startsWith(i))return null;if(!r[e].startsWith(t))return i}return f(t,r)}t.LocalEchoAddon=function(){function t(t){void 0===t&&(t={historySize:10,maxAutocompleteEntries:100}),this.history=void 0,this.terminal=void 0,this.disposables=[],this.maxAutocompleteEntries=void 0,this.autocompleteHandlers=[],this.active=!1,this.input="",this.cursor=0,this.activePrompt=null,this.activeCharPrompt=null,this.terminalSize={cols:0,rows:0},this.history=new i(t.historySize),this.maxAutocompleteEntries=t.maxAutocompleteEntries}var e=t.prototype;return e.activate=function(t){this.terminal=t,this.attach()},e.dispose=function(){this.detach()},e.addAutocompleteHandler=function(t){this.autocompleteHandlers.push({fn:t,args:[].slice.call(arguments,1)})},e.removeAutocompleteHandler=function(t){var r=this.autocompleteHandlers.findIndex(function(r){return r.fn===t});-1!==r&&this.autocompleteHandlers.splice(r,1)},e.read=function(t,r){void 0===r&&(r="> ");try{var i=this;return Promise.resolve(new Promise(function(e,s){i.terminal.write(t),i.activePrompt={prompt:t,continuationPrompt:r,resolve:e,reject:s},i.input="",i.cursor=0,i.active=!0}))}catch(t){return Promise.reject(t)}},e.readChar=function(t){var r=this;return new Promise(function(i,e){r.terminal.write(t),r.activeCharPrompt={prompt:t,resolve:i,reject:e}})},e.abortRead=function(t){void 0===t&&(t="aborted"),null==this.activePrompt&&null==this.activeCharPrompt||this.terminal.write("\r\n"),null!=this.activePrompt&&(this.activePrompt.reject(t),this.activePrompt=null),null!=this.activeCharPrompt&&(this.activeCharPrompt.reject(t),this.activeCharPrompt=null),this.active=!1},e.println=function(t){this.print(t+"\n")},e.print=function(t){var r=t.replace(/[\r\n]+/g,"\n");this.terminal.write(r.replace(/\n/g,"\r\n"))},e.printWide=function(t,r){if(void 0===r&&(r=2),0==t.length)return this.println("");for(var i=t.reduce(function(t,r){return Math.max(t,r.length)},0)+r,e=Math.floor(this.terminalSize.cols/i),s=Math.ceil(t.length/e),n=0,o=0;o<s;++o){for(var h="",a=0;a<e;++a)if(n<t.length){var u=t[n++];h+=u+=" ".repeat(i-u.length)}this.println(h)}},e.attach=function(){var t=this;this.terminal&&(this.disposables.push(this.terminal.onData(function(r){return t.handleTermData(r)})),this.disposables.push(this.terminal.onResize(function(r){return t.handleTermResize(r)})),this.terminalSize={cols:this.terminal.cols,rows:this.terminal.rows})},e.detach=function(){this.disposables.forEach(function(t){return t.dispose()}),this.disposables=[]},e.applyPrompts=function(t){return((this.activePrompt||{}).prompt||"")+t.replace(/\n/g,"\n"+((this.activePrompt||{}).continuationPrompt||""))},e.applyPromptOffset=function(t,i){return this.applyPrompts(t.substr(0,i)).replace(r(),"").length},e.clearInput=function(){for(var t=this.applyPrompts(this.input),r=l(t,this.terminalSize.cols),i=r-u(t,this.applyPromptOffset(this.input,this.cursor),this.terminalSize.cols).row-1,e=0;e<i;++e)this.terminal.write("[E");this.terminal.write("\r[K");for(var s=1;s<r;++s)this.terminal.write("[F[K")},e.setInput=function(t,r){void 0===r&&(r=!0),r&&this.clearInput();var i=this.applyPrompts(t);this.print(i),this.cursor>t.length&&(this.cursor=t.length);var e=this.applyPromptOffset(t,this.cursor),s=l(i,this.terminalSize.cols),n=u(i,e,this.terminalSize.cols),o=n.col,h=s-n.row-1;this.terminal.write("\r");for(var a=0;a<h;++a)this.terminal.write("[F");for(var c=0;c<o;++c)this.terminal.write("[C");this.input=t},e.printAndRestartPrompt=function(t){var r=this,i=this.cursor;this.setCursor(this.input.length),this.terminal.write("\r\n");var e=function(){r.cursor=i,r.setInput(r.input)},s=t();null==s?e():s.then(e)},e.setCursor=function(t){t<0&&(t=0),t>this.input.length&&(t=this.input.length);var r=this.applyPrompts(this.input),i=u(r,this.applyPromptOffset(this.input,this.cursor),this.terminalSize.cols),e=i.col,s=i.row,n=u(r,this.applyPromptOffset(this.input,t),this.terminalSize.cols),o=n.col,h=n.row;if(h>s)for(var a=s;a<h;++a)this.terminal.write("[B");else for(var l=h;l<s;++l)this.terminal.write("[A");if(o>e)for(var c=e;c<o;++c)this.terminal.write("[C");else for(var p=o;p<e;++p)this.terminal.write("[D");this.cursor=t},e.handleCursorMove=function(t){if(t>0){var r=Math.min(t,this.input.length-this.cursor);this.setCursor(this.cursor+r)}else if(t<0){var i=Math.max(t,-this.cursor);this.setCursor(this.cursor+i)}},e.handleCursorErase=function(t){if(t){if(this.cursor<=0)return;var r=this.input.substr(0,this.cursor-1)+this.input.substr(this.cursor);this.clearInput(),this.cursor-=1,this.setInput(r,!1)}else{var i=this.input.substr(0,this.cursor)+this.input.substr(this.cursor+1);this.setInput(i)}},e.handleCursorInsert=function(t){var r=this.input.substr(0,this.cursor)+t+this.input.substr(this.cursor);this.cursor+=t.length,this.setInput(r)},e.handleReadComplete=function(){this.history&&this.history.push(this.input),this.activePrompt&&(this.activePrompt.resolve(this.input),this.activePrompt=null),this.terminal.write("\r\n"),this.active=!1},e.handleTermResize=function(t){var r=t.rows,i=t.cols;this.clearInput(),this.terminalSize={cols:i,rows:r},this.setInput(this.input,!1)},e.handleTermData=function(t){var r=this;if(this.active){if(null!=this.activeCharPrompt)return this.activeCharPrompt.resolve(t),this.activeCharPrompt=null,void this.terminal.write("\r\n");if(t.length>3&&27!==t.charCodeAt(0)){var i=t.replace(/[\r\n]+/g,"\r");Array.from(i).forEach(function(t){return r.handleData(t)})}else this.handleData(t)}},e.handleData=function(t){var r=this;if(this.active){var i,e,s,n,u=t.charCodeAt(0);if(27==u)switch(t.substr(1)){case"[A":if(this.history){var l=this.history.getPrevious();l&&(this.setInput(l),this.setCursor(l.length))}break;case"[B":if(this.history){var m=this.history.getNext();m||(m=""),this.setInput(m),this.setCursor(m.length)}break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this.input.length);break;case"[H":this.setCursor(0);break;case"b":null!=(i=a(this.input,this.cursor))&&this.setCursor(i);break;case"f":s=this.cursor,null!=(i=null==(n=h(e=this.input,!1).find(function(t){return t>s}))?e.length:n)&&this.setCursor(i);break;case"":null!=(i=a(this.input,this.cursor))&&(this.setInput(this.input.substr(0,i)+this.input.substr(this.cursor)),this.setCursor(i))}else if(u<32||127===u)switch(t){case"\r":!function(t){var r;return""!=t.trim()&&((t.match(/'/g)||[]).length%2!=0||(t.match(/"/g)||[]).length%2!=0||""==(null==(r=t.split(/(\|\||\||&&)/g).pop())?void 0:r.trim())||!(!t.endsWith("\\")||t.endsWith("\\\\")))}(this.input)?this.handleReadComplete():this.handleCursorInsert("\n");break;case"":this.handleCursorErase(!0);break;case"\t":if(this.autocompleteHandlers.length>0){var v=this.input.substr(0,this.cursor),d=c(v),g=function(t,r){var i=o(r),e=i.length-1,s=i[e]||"";return""===r.trim()?(e=0,s=""):c(r)&&(e+=1,s=""),t.reduce(function(t,r){var s=r.fn,n=r.args;try{return t.concat(s.apply(void 0,[e,i].concat(n)))}catch(r){return console.error("Auto-complete error:",r),t}},[]).filter(function(t){return t.startsWith(s)})}(this.autocompleteHandlers,v);if(g.sort(),0===g.length)d||this.handleCursorInsert(" ");else if(1===g.length){var b=p(v);this.handleCursorInsert(g[0].substr(b.length)+" ")}else if(g.length<=this.maxAutocompleteEntries){var w=f(v,g);if(w){var C=p(v);this.handleCursorInsert(w.substr(C.length))}this.printAndRestartPrompt(function(){r.printWide(g)})}else this.printAndRestartPrompt(function(){return r.readChar("Display all "+g.length+" possibilities? (y or n)").then(function(t){"y"!=t&&"Y"!=t||r.printWide(g)})})}else this.handleCursorInsert("    ");break;case"":this.setCursor(this.input.length),this.terminal.write("^C\r\n"+((this.activePrompt||{}).prompt||"")),this.input="",this.cursor=0,this.history&&this.history.rewind()}else this.handleCursorInsert(t)}},t}()});
//# sourceMappingURL=index.umd.js.map
