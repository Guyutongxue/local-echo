!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t||self).xtermLocalEcho={})}(this,function(t){for(var r=function(){function t(t){this.size=void 0,this.entries=[],this.cursor=0,this.size=t}var r=t.prototype;return r.push=function(t){""!==t.trim()&&t!=this.entries[this.entries.length-1]&&(this.entries.push(t),this.entries.length>this.size&&this.entries.shift(),this.cursor=this.entries.length)},r.rewind=function(){this.cursor=this.entries.length},r.getPrevious=function(){var t=Math.max(0,this.cursor-1);return this.cursor=t,this.entries[t]},r.getNext=function(){var t=Math.min(this.entries.length,this.cursor+1);return this.cursor=t,this.entries[t]},t}(),e="(?:"+["\\|\\|","\\&\\&",";;","\\|\\&","\\<\\(",">>",">\\&","[&;()|<>]"].join("|")+")",i="",n=0;n<4;n++)i+=(Math.pow(16,8)*Math.random()).toString(16);var s=function(t,r,n){var s=function(t,r,n){var s=new RegExp(["("+e+")","((\\\\['\"|&;()<> \\t]|[^\\s'\"|&;()<> \\t])+|\"((\\\\\"|[^\"])*?)\"|'((\\\\'|[^'])*?)')*"].join("|"),"g"),o=t.match(s).filter(Boolean),a=!1;return o?(r||(r={}),n||(n={}),o.map(function(t,s){if(!a){if(RegExp("^"+e+"$").test(t))return{op:t};for(var h=n.escape||"\\",u=!1,l=!1,c="",p=!1,f=0,m=t.length;f<m;f++){var v=t.charAt(f);if(p=p||!u&&("*"===v||"?"===v),l)c+=v,l=!1;else if(u)v===u?u=!1:c+="'"==u?v:v===h?'"'===(v=t.charAt(f+=1))||v===h||"$"===v?v:h+v:"$"===v?d():v;else if('"'===v||"'"===v)u=v;else{if(RegExp("^"+e+"$").test(v))return{op:t};if(RegExp("^#$").test(v))return a=!0,c.length?[c,{comment:t.slice(f+1)+o.slice(s+1).join(" ")}]:[{comment:t.slice(f+1)+o.slice(s+1).join(" ")}];v===h?l=!0:c+="$"===v?d():v}}return p?{op:"glob",pattern:c}:c}function d(){var e,n,s,o;if("{"===t.charAt(f+=1)){if("}"===t.charAt(f+=1))throw new Error("Bad substitution: "+t.substr(f-2,3));if((e=t.indexOf("}",f))<0)throw new Error("Bad substitution: "+t.substr(f));n=t.substr(f,e-f),f=e}else/[*@#?$!_\-]/.test(t.charAt(f))?(n=t.charAt(f),f+=1):(e=t.substr(f).match(/[^\w\d_]/))?(n=t.substr(f,e.index),f+=e.index-1):(n=t.substr(f),f=t.length);return s=n,void 0===(o="function"==typeof r?r(s):r[s])&&""!=s?o="":void 0===o&&(o="$"),"object"==typeof o?""+i+JSON.stringify(o)+i:""+o}}).reduce(function(t,r){return void 0===r?t:t.concat(r)},[])):[]}(t,r,n);return"function"!=typeof r?s:s.reduce(function(t,r){if("object"==typeof r)return t.concat(r);var e=r.split(RegExp("("+i+".*?"+i+")","g"));return t.concat(1===e.length?e[0]:e.filter(Boolean).map(function(t){return RegExp("^"+i).test(t)?JSON.parse(t.split(i)[1]):t}))},[])};function o(t,r){var e;void 0===r&&(r=!0);for(var i=[],n=/\w+/g;e=n.exec(t);)i.push(r?e.index:e.index+e[0].length);return i}function a(t,r){var e=o(t,!0).reverse().find(function(t){return t<r});return null==e?0:e}function h(t,r,e){for(var i=0,n=0,s=0;s<r;++s)("\n"==t.charAt(s)||(n+=1)>e)&&(n=0,i+=1);return{row:i,col:n}}function u(t,r){return h(t,t.length,r).row+1}function l(t){return null!=t.match(/[^\\][ \t]$/m)}function c(t){return""===t.trim()||l(t)?"":s(t).pop()||""}function p(t,r){if(t.length>=r[0].length)return t;var e=t;t+=r[0].slice(t.length,t.length+1);for(var i=0;i<r.length;i++){if(!r[i].startsWith(e))return null;if(!r[i].startsWith(t))return e}return p(t,r)}t.LocalEchoAddon=function(){function t(t){var e=this;void 0===t&&(t={historySize:10,maxAutocompleteEntries:100}),this.terminal=void 0,this.disposables=[],this.history=void 0,this.maxAutocompleteEntries=void 0,this.autocompleteHandlers=[],this.active=!1,this.input="",this.cursor=0,this.activePrompt=null,this.activeCharPrompt=null,this.terminalSize={cols:0,rows:0},this.handleTermData=function(t){if(e.active){if(null!=e.activeCharPrompt)return e.activeCharPrompt.resolve(t),e.activeCharPrompt=null,void e.terminal.write("\r\n");if(t.length>3&&27!==t.charCodeAt(0)){var r=t.replace(/[\r\n]+/g,"\r");Array.from(r).forEach(function(t){return e.handleData(t)})}else e.handleData(t)}},this.handleData=function(t){if(e.active){var r,i,n,h,u=t.charCodeAt(0);if(27==u)switch(t.substr(1)){case"[A":if(e.history){var f=e.history.getPrevious();f&&(e.setInput(f),e.setCursor(f.length))}break;case"[B":if(e.history){var m=e.history.getNext();m||(m=""),e.setInput(m),e.setCursor(m.length)}break;case"[D":e.handleCursorMove(-1);break;case"[C":e.handleCursorMove(1);break;case"[3~":e.handleCursorErase(!1);break;case"[F":e.setCursor(e.input.length);break;case"[H":e.setCursor(0);break;case"b":null!=(r=a(e.input,e.cursor))&&e.setCursor(r);break;case"f":n=e.cursor,null!=(r=null==(h=o(i=e.input,!1).find(function(t){return t>n}))?i.length:h)&&e.setCursor(r);break;case"":null!=(r=a(e.input,e.cursor))&&(e.setInput(e.input.substr(0,r)+e.input.substr(e.cursor)),e.setCursor(r))}else if(u<32||127===u)switch(t){case"\r":!function(t){var r;return""!=t.trim()&&((t.match(/'/g)||[]).length%2!=0||(t.match(/"/g)||[]).length%2!=0||""==(null==(r=t.split(/(\|\||\||&&)/g).pop())?void 0:r.trim())||!(!t.endsWith("\\")||t.endsWith("\\\\")))}(e.input)?e.handleReadComplete():e.handleCursorInsert("\n");break;case"":e.handleCursorErase(!0);break;case"\t":if(e.autocompleteHandlers.length>0){var v=e.input.substr(0,e.cursor),d=l(v),g=function(t,r){var e=s(r),i=e.length-1,n=e[i]||"";return""===r.trim()?(i=0,n=""):l(r)&&(i+=1,n=""),t.reduce(function(t,r){var n=r.fn,s=r.args;try{return t.concat(n.apply(void 0,[i,e].concat(s)))}catch(r){return console.error("Auto-complete error:",r),t}},[]).filter(function(t){return t.startsWith(n)})}(e.autocompleteHandlers,v);if(g.sort(),0===g.length)d||e.handleCursorInsert(" ");else if(1===g.length){var b=c(v);e.handleCursorInsert(g[0].substr(b.length)+" ")}else if(g.length<=e.maxAutocompleteEntries){var w=p(v,g);if(w){var C=c(v);e.handleCursorInsert(w.substr(C.length))}e.printAndRestartPrompt(function(){e.printWide(g)})}else e.printAndRestartPrompt(function(){return e.readChar("Display all "+g.length+" possibilities? (y or n)").then(function(t){"y"!=t&&"Y"!=t||e.printWide(g)})})}else e.handleCursorInsert("    ");break;case"":e.setCursor(e.input.length),e.terminal.write("^C\r\n"+((e.activePrompt||{}).prompt||"")),e.input="",e.cursor=0,e.history&&e.history.rewind()}else e.handleCursorInsert(t)}},this.history=new r(t.historySize),this.maxAutocompleteEntries=t.maxAutocompleteEntries}var e=t.prototype;return e.activate=function(t){this.terminal=t,this.attach()},e.dispose=function(){this.detach()},e.addAutocompleteHandler=function(t){this.autocompleteHandlers.push({fn:t,args:[].slice.call(arguments,1)})},e.removeAutocompleteHandler=function(t){var r=this.autocompleteHandlers.findIndex(function(r){return r.fn===t});-1!==r&&this.autocompleteHandlers.splice(r,1)},e.read=function(t,r){void 0===r&&(r="> ");try{var e=this;return Promise.resolve(new Promise(function(i,n){e.terminal.write(t),e.activePrompt={prompt:t,continuationPrompt:r,resolve:i,reject:n},e.input="",e.cursor=0,e.active=!0}))}catch(t){return Promise.reject(t)}},e.readChar=function(t){var r=this;return new Promise(function(e,i){r.terminal.write(t),r.activeCharPrompt={prompt:t,resolve:e,reject:i}})},e.abortRead=function(t){void 0===t&&(t="aborted"),null==this.activePrompt&&null==this.activeCharPrompt||this.terminal.write("\r\n"),null!=this.activePrompt&&(this.activePrompt.reject(t),this.activePrompt=null),null!=this.activeCharPrompt&&(this.activeCharPrompt.reject(t),this.activeCharPrompt=null),this.active=!1},e.println=function(t){this.print(t+"\n")},e.print=function(t){var r=t.replace(/[\r\n]+/g,"\n");this.terminal.write(r.replace(/\n/g,"\r\n"))},e.printWide=function(t,r){if(void 0===r&&(r=2),0==t.length)return this.println("");for(var e=t.reduce(function(t,r){return Math.max(t,r.length)},0)+r,i=Math.floor(this.terminalSize.cols/e),n=Math.ceil(t.length/i),s=0,o=0;o<n;++o){for(var a="",h=0;h<i;++h)if(s<t.length){var u=t[s++];a+=u+=" ".repeat(e-u.length)}this.println(a)}},e.attach=function(){this.terminal&&(this.disposables.push(this.terminal.onData(this.handleTermData)),this.disposables.push(this.terminal.onResize(this.handleTermResize)),this.terminalSize={cols:this.terminal.cols,rows:this.terminal.rows})},e.detach=function(){this.disposables.forEach(function(t){return t.dispose()}),this.disposables=[]},e.applyPrompts=function(t){return((this.activePrompt||{}).prompt||"")+t.replace(/\n/g,"\n"+((this.activePrompt||{}).continuationPrompt||""))},e.applyPromptOffset=function(t,r){return this.applyPrompts(t.substr(0,r)).length},e.clearInput=function(){for(var t=this.applyPrompts(this.input),r=u(t,this.terminalSize.cols),e=r-h(t,this.applyPromptOffset(this.input,this.cursor),this.terminalSize.cols).row-1,i=0;i<e;++i)this.terminal.write("[E");this.terminal.write("\r[K");for(var n=1;n<r;++n)this.terminal.write("[F[K")},e.setInput=function(t,r){void 0===r&&(r=!0),r&&this.clearInput();var e=this.applyPrompts(t);this.print(e),this.cursor>t.length&&(this.cursor=t.length);var i=this.applyPromptOffset(t,this.cursor),n=u(e,this.terminalSize.cols),s=h(e,i,this.terminalSize.cols),o=s.col,a=n-s.row-1;this.terminal.write("\r");for(var l=0;l<a;++l)this.terminal.write("[F");for(var c=0;c<o;++c)this.terminal.write("[C");this.input=t},e.printAndRestartPrompt=function(t){var r=this,e=this.cursor;this.setCursor(this.input.length),this.terminal.write("\r\n");var i=function(){r.cursor=e,r.setInput(r.input)},n=t();null==n?i():n.then(i)},e.setCursor=function(t){t<0&&(t=0),t>this.input.length&&(t=this.input.length);var r=this.applyPrompts(this.input),e=h(r,this.applyPromptOffset(this.input,this.cursor),this.terminalSize.cols),i=e.col,n=e.row,s=h(r,this.applyPromptOffset(this.input,t),this.terminalSize.cols),o=s.col,a=s.row;if(a>n)for(var u=n;u<a;++u)this.terminal.write("[B");else for(var l=a;l<n;++l)this.terminal.write("[A");if(o>i)for(var c=i;c<o;++c)this.terminal.write("[C");else for(var p=o;p<i;++p)this.terminal.write("[D");this.cursor=t},e.handleCursorMove=function(t){if(t>0){var r=Math.min(t,this.input.length-this.cursor);this.setCursor(this.cursor+r)}else if(t<0){var e=Math.max(t,-this.cursor);this.setCursor(this.cursor+e)}},e.handleCursorErase=function(t){if(t){if(this.cursor<=0)return;var r=this.input.substr(0,this.cursor-1)+this.input.substr(this.cursor);this.clearInput(),this.cursor-=1,this.setInput(r,!1)}else{var e=this.input.substr(0,this.cursor)+this.input.substr(this.cursor+1);this.setInput(e)}},e.handleCursorInsert=function(t){var r=this.input.substr(0,this.cursor)+t+this.input.substr(this.cursor);this.cursor+=t.length,this.setInput(r)},e.handleReadComplete=function(){this.history&&this.history.push(this.input),this.activePrompt&&(this.activePrompt.resolve(this.input),this.activePrompt=null),this.terminal.write("\r\n"),this.active=!1},e.handleTermResize=function(t){var r=t.rows,e=t.cols;this.clearInput(),this.terminalSize={cols:e,rows:r},this.setInput(this.input,!1)},t}()});
//# sourceMappingURL=index.umd.js.map
