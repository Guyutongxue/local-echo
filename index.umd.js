!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t||self).xtermLocalEcho={})}(this,function(t){function r(t){var r=(void 0===t?{}:t).onlyFirst,e=void 0!==r&&r,i=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(i,e?void 0:"g")}for(var e=function(){function t(t){this.size=void 0,this.entries=[],this.cursor=0,this.size=t}var r=t.prototype;return r.push=function(t){""!==t.trim()&&(t!==this.entries[this.entries.length-1]?(this.entries.push(t),this.entries.length>this.size&&this.entries.shift(),this.cursor=this.entries.length):this.cursor=this.entries.length)},r.rewind=function(){this.cursor=this.entries.length},r.getPrevious=function(){var t=Math.max(0,this.cursor-1);return this.cursor=t,this.entries[t]},r.getNext=function(){var t=Math.min(this.entries.length,this.cursor+1);return this.cursor=t,this.entries[t]},t}(),i="(?:"+["\\|\\|","\\&\\&",";;","\\|\\&","\\<\\(",">>",">\\&","[&;()|<>]"].join("|")+")",n="",s=0;s<4;s++)n+=(Math.pow(16,8)*Math.random()).toString(16);var o=function(t,r,e){var s=function(t,r,e){var s=new RegExp(["("+i+")","((\\\\['\"|&;()<> \\t]|[^\\s'\"|&;()<> \\t])+|\"((\\\\\"|[^\"])*?)\"|'((\\\\'|[^'])*?)')*"].join("|"),"g"),o=t.match(s).filter(Boolean),a=!1;return o?(r||(r={}),e||(e={}),o.map(function(t,s){if(!a){if(RegExp("^"+i+"$").test(t))return{op:t};for(var h=e.escape||"\\",u=!1,l=!1,c="",p=!1,f=0,m=t.length;f<m;f++){var v=t.charAt(f);if(p=p||!u&&("*"===v||"?"===v),l)c+=v,l=!1;else if(u)v===u?u=!1:c+="'"==u?v:v===h?'"'===(v=t.charAt(f+=1))||v===h||"$"===v?v:h+v:"$"===v?d():v;else if('"'===v||"'"===v)u=v;else{if(RegExp("^"+i+"$").test(v))return{op:t};if(RegExp("^#$").test(v))return a=!0,c.length?[c,{comment:t.slice(f+1)+o.slice(s+1).join(" ")}]:[{comment:t.slice(f+1)+o.slice(s+1).join(" ")}];v===h?l=!0:c+="$"===v?d():v}}return p?{op:"glob",pattern:c}:c}function d(){var e,i,s,o;if("{"===t.charAt(f+=1)){if("}"===t.charAt(f+=1))throw new Error("Bad substitution: "+t.substr(f-2,3));if((e=t.indexOf("}",f))<0)throw new Error("Bad substitution: "+t.substr(f));i=t.substr(f,e-f),f=e}else/[*@#?$!_\-]/.test(t.charAt(f))?(i=t.charAt(f),f+=1):(e=t.substr(f).match(/[^\w\d_]/))?(i=t.substr(f,e.index),f+=e.index-1):(i=t.substr(f),f=t.length);return s=i,void 0===(o="function"==typeof r?r(s):r[s])&&""!=s?o="":void 0===o&&(o="$"),"object"==typeof o?""+n+JSON.stringify(o)+n:""+o}}).reduce(function(t,r){return void 0===r?t:t.concat(r)},[])):[]}(t,r,e);return"function"!=typeof r?s:s.reduce(function(t,r){if("object"==typeof r)return t.concat(r);var e=r.split(RegExp("("+n+".*?"+n+")","g"));return t.concat(1===e.length?e[0]:e.filter(Boolean).map(function(t){return RegExp("^"+n).test(t)?JSON.parse(t.split(n)[1]):t}))},[])};function a(t,r){var e;void 0===r&&(r=!0);for(var i=[],n=/\w+/g;e=n.exec(t);)i.push(r?e.index:e.index+e[0].length);return i}function h(t,r){var e=a(t,!0).reverse().find(function(t){return t<r});return null==e?0:e}function u(t,r,e){for(var i=0,n=0,s=0;s<r;++s)("\n"===t.charAt(s)||(n+=1)>e)&&(n=0,i+=1);return{row:i,col:n}}function l(t,e){return u(t,t.replace(r(),"").length,e).row+1}function c(t){return null!=t.match(/[^\\][ \t]$/m)}function p(t){return""===t.trim()||c(t)?"":o(t).pop()||""}function f(t,r){if(t.length>=r[0].length)return t;var e=t;t+=r[0].slice(t.length,t.length+1);for(var i=0;i<r.length;i++){if(!r[i].startsWith(e))return null;if(!r[i].startsWith(t))return e}return f(t,r)}t.LocalEchoAddon=function(){function t(t){var r=this;void 0===t&&(t={historySize:10,maxAutocompleteEntries:100}),this.terminal=void 0,this.disposables=[],this.history=void 0,this.maxAutocompleteEntries=void 0,this.autocompleteHandlers=[],this.active=!1,this.input="",this.cursor=0,this.activePrompt=null,this.activeCharPrompt=null,this.terminalSize={cols:0,rows:0},this.handleTermData=function(t){if(r.active){if(null!=r.activeCharPrompt)return r.activeCharPrompt.resolve(t),r.activeCharPrompt=null,void r.terminal.write("\r\n");if(t.length>3&&27!==t.charCodeAt(0)){var e=t.replace(/[\r\n]+/g,"\r");Array.from(e).forEach(function(t){return r.handleData(t)})}else r.handleData(t)}},this.handleData=function(t){if(r.active){var e,i,n,s,u=t.charCodeAt(0);if(27==u)switch(t.substr(1)){case"[A":if(r.history){var l=r.history.getPrevious();l&&(r.setInput(l),r.setCursor(l.length))}break;case"[B":if(r.history){var m=r.history.getNext();m||(m=""),r.setInput(m),r.setCursor(m.length)}break;case"[D":r.handleCursorMove(-1);break;case"[C":r.handleCursorMove(1);break;case"[3~":r.handleCursorErase(!1);break;case"[F":r.setCursor(r.input.length);break;case"[H":r.setCursor(0);break;case"b":null!=(e=h(r.input,r.cursor))&&r.setCursor(e);break;case"f":n=r.cursor,null!=(e=null==(s=a(i=r.input,!1).find(function(t){return t>n}))?i.length:s)&&r.setCursor(e);break;case"":null!=(e=h(r.input,r.cursor))&&(r.setInput(r.input.substr(0,e)+r.input.substr(r.cursor)),r.setCursor(e))}else if(u<32||127===u)switch(t){case"\r":!function(t){var r;return""!=t.trim()&&((t.match(/'/g)||[]).length%2!=0||(t.match(/"/g)||[]).length%2!=0||""==(null==(r=t.split(/(\|\||\||&&)/g).pop())?void 0:r.trim())||!(!t.endsWith("\\")||t.endsWith("\\\\")))}(r.input)?r.handleReadComplete():r.handleCursorInsert("\n");break;case"":r.handleCursorErase(!0);break;case"\t":if(r.autocompleteHandlers.length>0){var v=r.input.substr(0,r.cursor),d=c(v),g=function(t,r){var e=o(r),i=e.length-1,n=e[i]||"";return""===r.trim()?(i=0,n=""):c(r)&&(i+=1,n=""),t.reduce(function(t,r){var n=r.fn,s=r.args;try{return t.concat(n.apply(void 0,[i,e].concat(s)))}catch(r){return console.error("Auto-complete error:",r),t}},[]).filter(function(t){return t.startsWith(n)})}(r.autocompleteHandlers,v);if(g.sort(),0===g.length)d||r.handleCursorInsert(" ");else if(1===g.length){var b=p(v);r.handleCursorInsert(g[0].substr(b.length)+" ")}else if(g.length<=r.maxAutocompleteEntries){var w=f(v,g);if(w){var C=p(v);r.handleCursorInsert(w.substr(C.length))}r.printAndRestartPrompt(function(){r.printWide(g)})}else r.printAndRestartPrompt(function(){return r.readChar("Display all "+g.length+" possibilities? (y or n)").then(function(t){"y"!=t&&"Y"!=t||r.printWide(g)})})}else r.handleCursorInsert("    ");break;case"":r.setCursor(r.input.length),r.terminal.write("^C\r\n"+((r.activePrompt||{}).prompt||"")),r.input="",r.cursor=0,r.history&&r.history.rewind()}else r.handleCursorInsert(t)}},this.history=new e(t.historySize),this.maxAutocompleteEntries=t.maxAutocompleteEntries}var i=t.prototype;return i.activate=function(t){this.terminal=t,this.attach()},i.dispose=function(){this.detach()},i.addAutocompleteHandler=function(t){this.autocompleteHandlers.push({fn:t,args:[].slice.call(arguments,1)})},i.removeAutocompleteHandler=function(t){var r=this.autocompleteHandlers.findIndex(function(r){return r.fn===t});-1!==r&&this.autocompleteHandlers.splice(r,1)},i.read=function(t,r){void 0===r&&(r="> ");try{var e=this;return Promise.resolve(new Promise(function(i,n){e.terminal.write(t),e.activePrompt={prompt:t,continuationPrompt:r,resolve:i,reject:n},e.input="",e.cursor=0,e.active=!0}))}catch(t){return Promise.reject(t)}},i.readChar=function(t){var r=this;return new Promise(function(e,i){r.terminal.write(t),r.activeCharPrompt={prompt:t,resolve:e,reject:i}})},i.abortRead=function(t){void 0===t&&(t="aborted"),null==this.activePrompt&&null==this.activeCharPrompt||this.terminal.write("\r\n"),null!=this.activePrompt&&(this.activePrompt.reject(t),this.activePrompt=null),null!=this.activeCharPrompt&&(this.activeCharPrompt.reject(t),this.activeCharPrompt=null),this.active=!1},i.println=function(t){this.print(t+"\n")},i.print=function(t){var r=t.replace(/[\r\n]+/g,"\n");this.terminal.write(r.replace(/\n/g,"\r\n"))},i.printWide=function(t,r){if(void 0===r&&(r=2),0==t.length)return this.println("");for(var e=t.reduce(function(t,r){return Math.max(t,r.length)},0)+r,i=Math.floor(this.terminalSize.cols/e),n=Math.ceil(t.length/i),s=0,o=0;o<n;++o){for(var a="",h=0;h<i;++h)if(s<t.length){var u=t[s++];a+=u+=" ".repeat(e-u.length)}this.println(a)}},i.attach=function(){this.terminal&&(this.disposables.push(this.terminal.onData(this.handleTermData)),this.disposables.push(this.terminal.onResize(this.handleTermResize)),this.terminalSize={cols:this.terminal.cols,rows:this.terminal.rows})},i.detach=function(){this.disposables.forEach(function(t){return t.dispose()}),this.disposables=[]},i.applyPrompts=function(t){return((this.activePrompt||{}).prompt||"")+t.replace(/\n/g,"\n"+((this.activePrompt||{}).continuationPrompt||""))},i.applyPromptOffset=function(t,e){return this.applyPrompts(t.substr(0,e)).replace(r(),"").length},i.clearInput=function(){for(var t=this.applyPrompts(this.input),r=l(t,this.terminalSize.cols),e=r-u(t,this.applyPromptOffset(this.input,this.cursor),this.terminalSize.cols).row-1,i=0;i<e;++i)this.terminal.write("[E");this.terminal.write("\r[K");for(var n=1;n<r;++n)this.terminal.write("[F[K")},i.setInput=function(t,r){void 0===r&&(r=!0),r&&this.clearInput();var e=this.applyPrompts(t);this.print(e),this.cursor>t.length&&(this.cursor=t.length);var i=this.applyPromptOffset(t,this.cursor),n=l(e,this.terminalSize.cols),s=u(e,i,this.terminalSize.cols),o=s.col,a=n-s.row-1;this.terminal.write("\r");for(var h=0;h<a;++h)this.terminal.write("[F");for(var c=0;c<o;++c)this.terminal.write("[C");this.input=t},i.printAndRestartPrompt=function(t){var r=this,e=this.cursor;this.setCursor(this.input.length),this.terminal.write("\r\n");var i=function(){r.cursor=e,r.setInput(r.input)},n=t();null==n?i():n.then(i)},i.setCursor=function(t){t<0&&(t=0),t>this.input.length&&(t=this.input.length);var r=this.applyPrompts(this.input),e=u(r,this.applyPromptOffset(this.input,this.cursor),this.terminalSize.cols),i=e.col,n=e.row,s=u(r,this.applyPromptOffset(this.input,t),this.terminalSize.cols),o=s.col,a=s.row;if(a>n)for(var h=n;h<a;++h)this.terminal.write("[B");else for(var l=a;l<n;++l)this.terminal.write("[A");if(o>i)for(var c=i;c<o;++c)this.terminal.write("[C");else for(var p=o;p<i;++p)this.terminal.write("[D");this.cursor=t},i.handleCursorMove=function(t){if(t>0){var r=Math.min(t,this.input.length-this.cursor);this.setCursor(this.cursor+r)}else if(t<0){var e=Math.max(t,-this.cursor);this.setCursor(this.cursor+e)}},i.handleCursorErase=function(t){if(t){if(this.cursor<=0)return;var r=this.input.substr(0,this.cursor-1)+this.input.substr(this.cursor);this.clearInput(),this.cursor-=1,this.setInput(r,!1)}else{var e=this.input.substr(0,this.cursor)+this.input.substr(this.cursor+1);this.setInput(e)}},i.handleCursorInsert=function(t){var r=this.input.substr(0,this.cursor)+t+this.input.substr(this.cursor);this.cursor+=t.length,this.setInput(r)},i.handleReadComplete=function(){this.history&&this.history.push(this.input),this.activePrompt&&(this.activePrompt.resolve(this.input),this.activePrompt=null),this.terminal.write("\r\n"),this.active=!1},i.handleTermResize=function(t){var r=t.rows,e=t.cols;this.clearInput(),this.terminalSize={cols:e,rows:r},this.setInput(this.input,!1)},t}()});
//# sourceMappingURL=index.umd.js.map
